# HTML form 에서 파일 업로드 하기

## HTML 에서

- http 프로토콜은 기본적으로 text만 전송되도록 설계되었다.
- 인터넷 기술, 서비스가 확장되면서 여러가지 파일들을 첨부하여 서버로 전송할 필요가 생겼다.
- 기존의 http 프로토콜의 호환성을 유지하면서 파일을 전송할수 있는 방법을 생각하여 form 의 특별한 속성을 부여하고, http 프로토콜에서 적용하도록 하였다.
- 이미지 등 파일을 업로드 하려면 반드시 form tag 에 method 는 POST 이어야 하고, `enctype="multipart/form-data` 속성이 포함되어야 한다.

## Server 에서

- 대부분의 WAS 서버에서는 기본적으로 파일 업로드가 지원되지 않는다.
- WAS 서버에서 client 에서 전송된 파일을 수신(받기)위하여 3rd party 라이브러리를 사용한다.
- NodeJS 에서는 `multer` 라는 도구를 사용한다.
- multer 설치 : `npm install multer`

```bash
npm install multer
npm install uuid
```

## 서버에서 업로드된 파일 처리 방법 (multer가 함)

- 파일이 업로드 되었는지 감지하기
- 파일이 업로드 되었으면 업로드된 파일을 저장할 폴더가 있는지 확인
- 폴더에 업로드 된 파일을

## 업로드될 파일의 이름 변경

- 업로드 된 파일을 원본(originalname)으로 저장을 하면 보안에 취약한 부분이 발생한다.
- 만약 누군가가 악의적으로 같은 이름의 파일을 임의로 생성하여 업로드 하면 기존의 파일은 삭제되고 업로드된 파일로 대체되어 버린다. : `file Upload Injection` 공격이라고 한다.
- 파일을 저장할때는 `UUID` 와 같은 `UNIQUE` 한 값을 파일 이름에 부착하여 저장하는 것이 좋다.
- 이렇게 이름변형하여 저장하면 나중에 혹시 파일을 다운로드 할때 원본 이름과 다른 파일이 다운로드 될 수 있다.
- DB 에 파일 정보를 저장할때는 원본파일 이름과 변경된 파일이름을 같이 저장하는 것이 원칙이다.
